#dns with re & dup info line 
#removed response

import os
import subprocess
import time
import re

tshark_loc = os.path.join("C:\\", "Program Files", "Wireshark")
os.chdir(tshark_loc)

with open("C:\\users\\savid\\Desktop\\malware_analysis\\output3.txt") as stdout:
	subprocess.Popen("tshark -G column-formats", shell=True, stdout=stdout, stderr=stdout)

#the actual command
tsharkcmd1 = "tshark" 
tsharkcmd1 += " -r c:\\users\\savid\\desktop\\malware_analysis\\homies2.pcap -o "
tsharkcmd1 += "\"gui.column.format:\\"
tsharkcmd1 += "\"Information\\"
tsharkcmd1 += "\",\\\"%i\\\""
tsharkcmd1 += ", \"\"Destination\\"
tsharkcmd1 += "\",\\\"%d\\\"\"" #<= format spot
"""tshark.exe -o "gui.column.format:\"No.\",\"%m\",\"Time\",\"%t\",\"Source\",\"%s\",\"Destination\",\"%d\",\"Protocol\",\"%p\",\"Length\",\"%L\",\"Info\",\"%i\"
"""


#the command
with open("C:\\users\\savid\\Desktop\\malware_analysis\\output4.txt", "w") as stdout:
	subprocess.Popen(tsharkcmd1, shell=True, stdout=stdout, stderr=stdout)

time.sleep(1)

#internal de-duplication => clean up => Print
mylist=[]
with open("C:\\users\\savid\\Desktop\\malware_analysis\\output4.txt", 'r') as input_file:
	for line in input_file:
		if "query" in line:
			mylist.append(line)

newlist=[]
for x in mylist:
	x = re.findall("\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}", x)
	#print(x)
	newlist.append(x)


for y in newlist:
	print(y)
print(newlist)

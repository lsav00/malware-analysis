#everything gets deduplicated at regex, but have to create good source with WireShark
#deduplicate by dns info 

import os
import subprocess
import time
import re

tshark_loc = os.path.join("C:\\", "Program Files", "Wireshark")
os.chdir(tshark_loc)

with open("C:\\users\\savid\\Desktop\\malware_analysis\\output3.txt") as stdout:
	subprocess.Popen("tshark -G column-formats", shell=True, stdout=stdout, stderr=stdout)

#the actual command
tsharkcmd1 = "tshark" 
tsharkcmd1 += " -r c:\\users\\savid\\desktop\\malware_analysis\\homies2.pcap"

#the command
with open("C:\\users\\savid\\Desktop\\malware_analysis\\output4.txt", "w") as stdout:
	subprocess.Popen(tsharkcmd1, shell=True, stdout=stdout, stderr=stdout)

time.sleep(1)

#internal de-duplication => clean up => Print
choice=input("Enter d for DNS info") 

if choice=="d":
	mylist=[]
	with open("C:\\users\\savid\\Desktop\\malware_analysis\\output4.txt", 'r') as input_file:
		for line in input_file:
			if "query" in line:
				mylist.append(line)
			if "response" in line:
				mylist.append(line)
	newlist=[]
	for l in mylist:
		l=re.findall("Standard.+$", l)
		if l not in newlist:
			newlist.append(l)

	for x in newlist:
		print(x)
		
